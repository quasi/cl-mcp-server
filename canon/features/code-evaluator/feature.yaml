feature:
  name: code-evaluator
  version: 0.2.0
  status: draft
  description: |
    Evaluates Common Lisp expressions in a controlled environment.
    Captures return values (including multiple values), stdout, stderr.
    Handles conditions gracefully using handler-bind/handler-case.
    Supports reading multiple forms from a single code string.

    Phase 0 (Robustness): Provides timeout protection to prevent server
    hangs from infinite loops or expensive computations. Configurable
    limits allow adjusting timeout and output capture settings.

depends_on:
  core: true
  features:
    - session-management
    - error-handling

contracts:
  - evaluate-lisp-tool    # Main evaluation tool contract
  - configure-limits-tool # Safety limits configuration

properties:
  - evaluation-isolation   # Session state persists, isolated from other sessions
  - output-capture        # stdout, stderr, warnings separated and captured
  - timeout-protection    # Phase 0: Evaluation timeout with backtrace
  - state-persistence     # Definitions persist across evaluations (INV-003)
  - condition-handling    # Errors don't crash server (INV-002, INV-006)

scenarios:
  - basic-evaluation    # Arithmetic, strings, lists, multiple values
  - output-capture      # stdout, stderr, warnings
  - definitions         # defun, defvar, defmacro, defclass
  - timeout-handling    # Phase 0: Timeout triggers and recovery
